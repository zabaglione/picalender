# TASK-002: 設定管理システム - テストケース

## テストケース一覧

### 1. 基本機能テスト

#### TC-001: デフォルト設定の読み込み
- **前提条件**: 設定ファイルが存在しない
- **実行**: ConfigManagerを初期化
- **期待結果**: デフォルト設定が読み込まれる
- **検証項目**:
  - `config.screen.width == 1024`
  - `config.screen.height == 600`
  - `config.screen.fps == 30`

#### TC-002: YAMLファイルからの読み込み
- **前提条件**: 有効な`settings.yaml`が存在
- **実行**: ConfigManagerを初期化
- **期待結果**: YAMLファイルの設定が読み込まれる
- **検証項目**:
  - 設定値がファイルの内容と一致
  - ネストされた構造が正しく解析される

#### TC-003: 部分的な設定の読み込み
- **前提条件**: `settings.yaml`に一部の設定のみ存在
- **実行**: ConfigManagerを初期化
- **期待結果**: 
  - 存在する設定は読み込まれる
  - 不足分はデフォルト値が使用される
- **検証項目**:
  - カスタム値とデフォルト値が混在して正しく設定される

### 2. アクセス方法テスト

#### TC-004: ドット記法でのアクセス
- **前提条件**: ConfigManagerが初期化済み
- **実行**: `config.screen.width`でアクセス
- **期待結果**: 正しい値が取得できる
- **検証項目**: AttributeErrorが発生しない

#### TC-005: 辞書記法でのアクセス
- **前提条件**: ConfigManagerが初期化済み
- **実行**: `config['screen']['width']`でアクセス
- **期待結果**: 正しい値が取得できる
- **検証項目**: KeyErrorが発生しない

#### TC-006: get()メソッドでのアクセス
- **前提条件**: ConfigManagerが初期化済み
- **実行**: 
  - `config.get('screen.width')`
  - `config.get('non.existent', 'default')`
- **期待結果**: 
  - 存在するキーは値を返す
  - 存在しないキーはデフォルト値を返す
- **検証項目**: 例外が発生しない

### 3. 環境変数テスト

#### TC-007: 環境変数によるオーバーライド
- **前提条件**: 
  - `PICALENDAR_SCREEN_WIDTH=800`が設定されている
  - `settings.yaml`にwidth=1024が設定されている
- **実行**: ConfigManagerを初期化
- **期待結果**: width=800（環境変数優先）
- **検証項目**: 環境変数の値が優先される

#### TC-008: 環境変数の型変換
- **前提条件**: 
  - `PICALENDAR_SCREEN_FPS=60`（文字列）
  - `PICALENDAR_UI_COLORS_TEXT=[255,255,255]`（リスト）
- **実行**: ConfigManagerを初期化
- **期待結果**: 適切な型に変換される
- **検証項目**:
  - FPSがint型の60
  - textがリスト[255,255,255]

### 4. バリデーションテスト

#### TC-009: 型チェック
- **前提条件**: 不正な型の値が設定される
  - `screen.fps = "thirty"`（文字列、期待はint）
- **実行**: ConfigManagerを初期化
- **期待結果**: 
  - 警告ログが出力される
  - デフォルト値（30）が使用される
- **検証項目**: 
  - ログに警告が記録される
  - 値がデフォルトに置き換わる

#### TC-010: 範囲チェック
- **前提条件**: 範囲外の値が設定される
  - `screen.fps = 100`（範囲: 1-60）
  - `screen.width = -1024`（負の値）
- **実行**: ConfigManagerを初期化
- **期待結果**: 
  - 警告ログが出力される
  - 有効範囲内の値に修正される
- **検証項目**:
  - FPSが60に修正される
  - widthがデフォルト値になる

#### TC-011: 必須項目チェック
- **前提条件**: 必須項目が欠落
- **実行**: ConfigManagerを初期化
- **期待結果**: 
  - 警告ログが出力される
  - デフォルト値が使用される
- **検証項目**: アプリケーションが正常に起動する

### 5. エラー処理テスト

#### TC-012: 不正なYAMLファイル
- **前提条件**: 構文エラーのあるYAMLファイル
- **実行**: ConfigManagerを初期化
- **期待結果**: 
  - エラーログが出力される
  - デフォルト設定で継続
- **検証項目**: 
  - YAMLParseErrorが処理される
  - アプリケーションがクラッシュしない

#### TC-013: ファイル読み込みエラー
- **前提条件**: 読み込み権限のないファイル
- **実行**: ConfigManagerを初期化
- **期待結果**: 
  - エラーログが出力される
  - デフォルト設定で継続
- **検証項目**: 
  - PermissionErrorが処理される
  - デフォルト設定が使用される

### 6. 動的操作テスト

#### TC-014: 設定の更新
- **前提条件**: ConfigManagerが初期化済み
- **実行**: `config.set('screen.width', 1920)`
- **期待結果**: 実行時の値が更新される
- **検証項目**: 
  - 新しい値が反映される
  - ファイルには書き込まれない

#### TC-015: 設定の再読み込み
- **前提条件**: 
  - ConfigManagerが初期化済み
  - 設定ファイルが変更される
- **実行**: `config.reload()`
- **期待結果**: 新しい設定が読み込まれる
- **検証項目**: 変更が反映される

### 7. パフォーマンステスト

#### TC-016: 読み込み速度
- **前提条件**: 標準的な設定ファイル
- **実行**: ConfigManagerを初期化
- **期待結果**: 100ms以内に完了
- **検証項目**: 実行時間が100ms未満

#### TC-017: メモリ使用量
- **前提条件**: ConfigManagerが初期化済み
- **実行**: メモリ使用量を測定
- **期待結果**: 1MB以内
- **検証項目**: メモリ使用量が1MB未満

### 8. エッジケーステスト

#### TC-018: 空の設定ファイル
- **前提条件**: 空の`settings.yaml`
- **実行**: ConfigManagerを初期化
- **期待結果**: デフォルト設定が使用される
- **検証項目**: すべてデフォルト値

#### TC-019: 深くネストされた設定
- **前提条件**: 5階層以上のネスト
- **実行**: 深い階層へのアクセス
- **期待結果**: 正しくアクセスできる
- **検証項目**: すべての階層で値が取得できる

#### TC-020: 循環参照の検出
- **前提条件**: 設定内に循環参照
- **実行**: ConfigManagerを初期化
- **期待結果**: エラーが適切に処理される
- **検証項目**: 無限ループにならない