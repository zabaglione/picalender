# TASK-103: アセット管理システム - テストケース

## テストケース一覧

### 1. AssetManager基本テスト

#### TC-001: AssetManagerの初期化
- **前提条件**: assetsディレクトリが存在
- **実行**: AssetManagerを初期化
- **期待結果**: エラーなく初期化される
- **検証項目**:
  - インスタンスが作成される
  - ベースパスが設定される
  - 各マネージャーが初期化される

#### TC-002: アセットの事前読み込み
- **前提条件**: マニフェストファイルが存在
- **実行**: `preload()`でマニフェスト読み込み
- **期待結果**: 指定アセットが読み込まれる
- **検証項目**:
  - マニフェストが解析される
  - アセットがキャッシュされる
  - エラーがない

### 2. フォント管理テスト

#### TC-003: フォント読み込み
- **前提条件**: フォントファイルが存在
- **実行**: `load_font()`でフォント読み込み
- **期待結果**: フォントが読み込まれる
- **検証項目**:
  - pygame.font.Fontオブジェクトが返される
  - 指定サイズで読み込まれる
  - キャッシュされる

#### TC-004: 日本語フォント対応
- **前提条件**: 日本語フォントが存在
- **実行**: 日本語テキストをレンダリング
- **期待結果**: 正しく表示される
- **検証項目**:
  - 文字化けしない
  - 適切なサイズ
  - アンチエイリアス適用

#### TC-005: システムフォントフォールバック
- **前提条件**: 指定フォントが存在しない
- **実行**: 存在しないフォントを読み込み
- **期待結果**: システムフォントが使用される
- **検証項目**:
  - エラーが発生しない
  - 代替フォントが返される
  - 警告ログが出力される

#### TC-006: 複数サイズ管理
- **前提条件**: フォントファイルが存在
- **実行**: 同じフォントを異なるサイズで読み込み
- **期待結果**: 各サイズが個別に管理される
- **検証項目**:
  - サイズごとにキャッシュ
  - 正しいサイズで取得
  - メモリ効率的

### 3. 画像管理テスト

#### TC-007: PNG画像読み込み
- **前提条件**: PNG画像が存在
- **実行**: `load_image()`でPNG読み込み
- **期待結果**: 画像が読み込まれる
- **検証項目**:
  - pygame.Surfaceが返される
  - 透過情報が保持される
  - 正しいサイズ

#### TC-008: JPG画像読み込み
- **前提条件**: JPG画像が存在
- **実行**: `load_image()`でJPG読み込み
- **期待結果**: 画像が読み込まれる
- **検証項目**:
  - pygame.Surfaceが返される
  - RGB形式で読み込まれる
  - 圧縮アーティファクトなし

#### TC-009: 画像スケーリング
- **前提条件**: 画像が読み込み済み
- **実行**: 画像をスケール
- **期待結果**: 指定サイズに変換される
- **検証項目**:
  - アスペクト比維持オプション
  - スムーズスケーリング
  - パフォーマンス

#### TC-010: 画像回転・反転
- **前提条件**: 画像が読み込み済み
- **実行**: 回転・反転処理
- **期待結果**: 正しく変換される
- **検証項目**:
  - 任意角度の回転
  - 水平・垂直反転
  - 品質維持

### 4. スプライトシートテスト

#### TC-011: スプライトシート読み込み
- **前提条件**: スプライトシートが存在
- **実行**: `load_sprite_sheet()`実行
- **期待結果**: シートが読み込まれる
- **検証項目**:
  - SpriteSheetオブジェクト生成
  - フレームサイズ設定
  - 総フレーム数計算

#### TC-012: フレーム分割
- **前提条件**: スプライトシート読み込み済み
- **実行**: `get_frame()`でフレーム取得
- **期待結果**: 指定フレームが取得される
- **検証項目**:
  - 正しい位置から切り出し
  - フレームサイズ一致
  - インデックス境界チェック

#### TC-013: アニメーション取得
- **前提条件**: スプライトシート読み込み済み
- **実行**: `get_animation()`実行
- **期待結果**: フレームリストが返される
- **検証項目**:
  - 連続フレーム取得
  - 順序正しい
  - メモリ効率的

#### TC-014: メタデータサポート
- **前提条件**: JSONメタデータが存在
- **実行**: メタデータ付きで読み込み
- **期待結果**: アニメーション情報が設定される
- **検証項目**:
  - アニメーション名で取得
  - フレームレート情報
  - ループ設定

### 5. キャッシュ管理テスト

#### TC-015: キャッシュ追加
- **前提条件**: AssetCache初期化済み
- **実行**: アセットをキャッシュに追加
- **期待結果**: キャッシュされる
- **検証項目**:
  - キーで取得可能
  - アクセス時刻更新
  - サイズ制限内

#### TC-016: LRUアルゴリズム
- **前提条件**: キャッシュが満杯
- **実行**: 新しいアセット追加
- **期待結果**: 最も古いアセットが削除される
- **検証項目**:
  - LRU順で削除
  - サイズ制限維持
  - 統計更新

#### TC-017: キャッシュヒット率
- **前提条件**: 複数アセットキャッシュ済み
- **実行**: 繰り返しアクセス
- **期待結果**: ヒット率が計測される
- **検証項目**:
  - ヒット/ミスカウント
  - パーセンテージ計算
  - 統計取得

#### TC-018: 手動パージ
- **前提条件**: キャッシュにデータあり
- **実行**: `clear_cache()`実行
- **期待結果**: キャッシュがクリアされる
- **検証項目**:
  - 全エントリ削除
  - メモリ解放
  - 統計リセット

### 6. 動的リロードテスト

#### TC-019: ファイル変更検出
- **前提条件**: FileWatcher起動中
- **実行**: ファイルを変更
- **期待結果**: 変更が検出される
- **検証項目**:
  - 変更通知
  - タイムスタンプ更新
  - イベント発火

#### TC-020: ホットリロード
- **前提条件**: 開発モード有効
- **実行**: アセットファイル更新
- **期待結果**: 自動的に再読み込み
- **検証項目**:
  - キャッシュ更新
  - 新しい内容反映
  - 既存参照は維持

#### TC-021: コールバック実行
- **前提条件**: コールバック登録済み
- **実行**: ファイル変更発生
- **期待結果**: コールバックが呼ばれる
- **検証項目**:
  - 正しい引数
  - 実行順序
  - エラーハンドリング

### 7. パス管理テスト

#### TC-022: 相対パス解決
- **前提条件**: ベースパス設定済み
- **実行**: 相対パスでアクセス
- **期待結果**: 正しく解決される
- **検証項目**:
  - パス結合
  - 正規化
  - クロスプラットフォーム

#### TC-023: 絶対パス処理
- **前提条件**: 絶対パスを指定
- **実行**: アセット読み込み
- **期待結果**: 正しく読み込まれる
- **検証項目**:
  - ベースパス無視
  - 直接アクセス
  - セキュリティチェック

### 8. エラー処理テスト

#### TC-024: ファイル不在エラー
- **前提条件**: 存在しないファイル指定
- **実行**: 読み込み試行
- **期待結果**: エラーハンドリング
- **検証項目**:
  - 例外キャッチ
  - デフォルト値返却
  - エラーログ出力

#### TC-025: 破損ファイル処理
- **前提条件**: 破損したファイル
- **実行**: 読み込み試行
- **期待結果**: グレースフル失敗
- **検証項目**:
  - クラッシュしない
  - エラーログ
  - 代替処理

#### TC-026: メモリ不足対応
- **前提条件**: メモリ制限到達
- **実行**: 新規アセット読み込み
- **期待結果**: 自動パージ実行
- **検証項目**:
  - キャッシュクリア
  - メモリ解放
  - 警告ログ

### 9. パフォーマンステスト

#### TC-027: 読み込み速度
- **前提条件**: 標準的なアセット
- **実行**: 各種アセット読み込み
- **期待結果**: 時間制限内
- **検証項目**:
  - フォント: 100ms以内
  - 画像: 50ms以内
  - キャッシュヒット: 1ms以内

#### TC-028: メモリ使用量
- **前提条件**: 複数アセット読み込み
- **実行**: メモリ測定
- **期待結果**: 制限内
- **検証項目**:
  - 100MB以内
  - リーク無し
  - 効率的な管理

#### TC-029: 同時読み込み
- **前提条件**: 複数スレッド
- **実行**: 並行アクセス
- **期待結果**: 正常動作
- **検証項目**:
  - スレッドセーフ
  - デッドロック無し
  - パフォーマンス維持

## テスト実行計画

1. 単体テスト（TC-001〜TC-026）
2. パフォーマンステスト（TC-027〜TC-029）
3. 統合テスト（全体動作確認）

## 合格基準

- 全テストケースの90%以上が成功
- パフォーマンステストが目標値を達成
- メモリリークがない
- エラー処理が適切に機能