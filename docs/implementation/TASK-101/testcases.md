# TASK-101: pygame/SDL2初期化 - テストケース

## テストケース一覧

### 1. 基本初期化テスト

#### TC-001: DisplayManagerの初期化
- **前提条件**: ConfigManagerが初期化済み
- **実行**: DisplayManagerを初期化
- **期待結果**: エラーなく初期化される
- **検証項目**:
  - DisplayManagerインスタンスが作成される
  - configが正しく設定される

#### TC-002: pygame初期化
- **前提条件**: DisplayManagerが作成済み
- **実行**: `initialize()`メソッドを呼び出し
- **期待結果**: pygameが初期化される
- **検証項目**:
  - pygame.get_init()がTrueを返す
  - 必要なサブシステムが初期化される

#### TC-003: スクリーン作成
- **前提条件**: pygameが初期化済み
- **実行**: `create_screen()`を呼び出し
- **期待結果**: スクリーンサーフェスが作成される
- **検証項目**:
  - pygame.Surfaceオブジェクトが返される
  - サイズが1024×600（設定値）

### 2. 環境検出テスト

#### TC-004: 環境検出 - 開発環境
- **前提条件**: 開発環境（macOS/Windows/Linux desktop）
- **実行**: EnvironmentDetector.is_raspberry_pi()
- **期待結果**: Falseが返される
- **検証項目**: 正しく環境を判定

#### TC-005: ビデオドライバー選択
- **前提条件**: 各OS環境
- **実行**: EnvironmentDetector.get_video_driver()
- **期待結果**: 適切なドライバー名が返される
- **検証項目**:
  - macOS: デフォルト
  - Linux: x11
  - Windows: windib
  - Raspberry Pi: kmsdrm

#### TC-006: ディスプレイ接続確認
- **前提条件**: ディスプレイが接続されている
- **実行**: EnvironmentDetector.has_display()
- **期待結果**: Trueが返される
- **検証項目**: DISPLAY環境変数または物理接続を検出

### 3. 画面設定テスト

#### TC-007: フルスクリーン設定
- **前提条件**: スクリーンが作成済み
- **実行**: `set_fullscreen(True)`
- **期待結果**: フルスクリーンモードが有効になる
- **検証項目**:
  - 設定が反映される
  - 開発環境では無視される（設定による）

#### TC-008: ウィンドウモード切り替え
- **前提条件**: フルスクリーンモード
- **実行**: `set_fullscreen(False)`
- **期待結果**: ウィンドウモードに切り替わる
- **検証項目**: モードが正しく切り替わる

#### TC-009: マウスカーソル非表示
- **前提条件**: スクリーンが作成済み
- **実行**: `hide_cursor(True)`
- **期待結果**: マウスカーソルが非表示になる
- **検証項目**:
  - pygame.mouse.set_visible(False)が呼ばれる
  - カーソル状態が変更される

#### TC-010: マウスカーソル表示
- **前提条件**: カーソルが非表示
- **実行**: `hide_cursor(False)`
- **期待結果**: マウスカーソルが表示される
- **検証項目**: カーソルが表示される

### 4. FPS制御テスト

#### TC-011: Clockオブジェクト取得
- **前提条件**: DisplayManagerが初期化済み
- **実行**: `get_clock()`
- **期待結果**: pygame.time.Clockオブジェクトが返される
- **検証項目**:
  - 有効なClockオブジェクト
  - tick()メソッドが使用可能

#### TC-012: FPS制御
- **前提条件**: Clockオブジェクトが取得済み
- **実行**: clock.tick(30)を複数回実行
- **期待結果**: 30FPS前後で制御される
- **検証項目**:
  - get_fps()が28-32の範囲
  - CPU使用率が適切

### 5. 描画操作テスト

#### TC-013: 画面クリア
- **前提条件**: スクリーンが作成済み
- **実行**: `clear((255, 0, 0))`
- **期待結果**: 画面が赤でクリアされる
- **検証項目**:
  - スクリーンサーフェスが指定色で塗りつぶされる

#### TC-014: 画面更新（flip）
- **前提条件**: スクリーンに描画済み
- **実行**: `flip()`
- **期待結果**: 画面が更新される
- **検証項目**:
  - pygame.display.flip()が呼ばれる
  - エラーが発生しない

#### TC-015: サーフェス情報取得
- **前提条件**: スクリーンが作成済み
- **実行**: `get_info()`
- **期待結果**: ディスプレイ情報が取得される
- **検証項目**:
  - 解像度情報
  - ビデオドライバー情報
  - FPS情報

### 6. エラー処理テスト

#### TC-016: pygame初期化失敗
- **前提条件**: SDL初期化が失敗する環境
- **実行**: initialize()（モック使用）
- **期待結果**: 
  - エラーログが出力される
  - フォールバック処理が実行される
- **検証項目**:
  - 例外がキャッチされる
  - ダミーモードで起動

#### TC-017: ディスプレイ未接続
- **前提条件**: ディスプレイが接続されていない
- **実行**: create_screen()
- **期待結果**:
  - 警告ログが出力される
  - ヘッドレスモードで動作
- **検証項目**:
  - ダミーサーフェスが作成される
  - アプリケーションは継続動作

#### TC-018: 解像度不一致
- **前提条件**: 要求解像度が利用不可
- **実行**: 高解像度でスクリーン作成
- **期待結果**:
  - 利用可能な解像度にフォールバック
  - 警告ログが出力される
- **検証項目**:
  - 代替解像度で動作
  - スケーリングが有効

### 7. リソース管理テスト

#### TC-019: 正常終了
- **前提条件**: DisplayManagerが動作中
- **実行**: `quit()`
- **期待結果**: リソースが解放される
- **検証項目**:
  - pygame.quit()が呼ばれる
  - メモリリークがない
  - 再初期化が可能

#### TC-020: 異常終了時のクリーンアップ
- **前提条件**: 動作中に例外発生
- **実行**: 例外を発生させる
- **期待結果**: リソースが適切に解放される
- **検証項目**:
  - finallyブロックでクリーンアップ
  - システムリソースの解放

### 8. パフォーマンステスト

#### TC-021: 初期化時間
- **前提条件**: 標準的な環境
- **実行**: 初期化から画面作成まで
- **期待結果**: 2秒以内に完了
- **検証項目**: 実行時間測定

#### TC-022: メモリ使用量
- **前提条件**: DisplayManager動作中
- **実行**: メモリ使用量を測定
- **期待結果**: 50MB以内
- **検証項目**: pygame関連のメモリ使用量

#### TC-023: CPU使用率
- **前提条件**: アイドル状態
- **実行**: メインループ実行（描画なし）
- **期待結果**: CPU使用率5%以下
- **検証項目**: CPU使用率測定

### 9. 統合テスト

#### TC-024: ConfigManagerとの連携
- **前提条件**: settings.yamlから設定読み込み
- **実行**: DisplayManager初期化
- **期待結果**: 設定が反映される
- **検証項目**:
  - 解像度が設定値通り
  - FPSが設定値通り
  - フルスクリーン設定が反映

#### TC-025: LogManagerとの連携
- **前提条件**: LogManagerが初期化済み
- **実行**: 各種操作でログ出力
- **期待結果**: 適切なログが記録される
- **検証項目**:
  - 初期化ログ
  - エラーログ
  - デバッグ情報